/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */
import{g as o,c as t,f as n}from"./p-b24aa895.js";import{a as i,b as a,r,c as e}from"./p-63eb0acd.js";import{a as s,K as c}from"./p-419eb426.js";import"./p-1b8e1d03.js";import"./p-cc196b34.js";import"./p-b347cfd1.js";const d=new WeakMap,l=(o,t,n,i=0,a=!1)=>{d.has(o)!==n&&(n?u(o,t,i,a):f(o,t))},u=(o,t,n,i=!1)=>{const a=t.parentNode,r=t.cloneNode(!1);r.classList.add("cloned-input"),r.tabIndex=-1,i&&(r.disabled=!0),a.appendChild(r),d.set(o,r);const e="rtl"===o.ownerDocument.dir?9999:-9999;o.style.pointerEvents="none",t.style.transform=`translate3d(${e}px,${n}px,0) scale(0)`},f=(o,t)=>{const n=d.get(o);n&&(d.delete(o),n.remove()),o.style.pointerEvents="",t.style.transform=""},p="input, textarea, [no-blur], [contenteditable]",w="$ionPaddingTimer",m=(o,t,n)=>{const i=o[w];i&&clearTimeout(i),t>0?o.style.setProperty("--keyboard-offset",`${t}px`):o[w]=setTimeout((()=>{o.style.setProperty("--keyboard-offset","0px"),n&&n()}),120)},b=(o,t,n)=>{o.addEventListener("focusout",(()=>{t&&m(t,0,n)}),{once:!0})};let h=0;const y="data-ionic-skip-scroll-assist",S=o=>{document.activeElement!==o&&(o.setAttribute(y,"true"),o.focus())},M=async(n,i,a,e,s,c,d=!1)=>{if(!a&&!e)return;const u=((o,t,n)=>{var i;return((o,t,n,i)=>{const a=o.top,r=o.bottom,e=t.top,s=e+15,c=Math.min(t.bottom,i-n)-50-r,d=s-a,l=Math.round(c<0?-c:d>0?-d:0),u=Math.min(l,a-e),f=Math.abs(u);return{scrollAmount:u,scrollDuration:Math.min(400,Math.max(150,f/.3)),scrollPadding:n,inputSafeY:4-(a-s)}})((null!==(i=o.closest("ion-item,[ion-item]"))&&void 0!==i?i:o).getBoundingClientRect(),t.getBoundingClientRect(),n,o.ownerDocument.defaultView.innerHeight)})(n,a||e,s);if(a&&Math.abs(u.scrollAmount)<4)return S(i),void(c&&null!==a&&(m(a,h),b(i,a,(()=>h=0))));if(l(n,i,!0,u.inputSafeY,d),S(i),r((()=>n.click())),c&&a&&(h=u.scrollPadding,m(a,h)),"undefined"!=typeof window){let r;const e=async()=>{void 0!==r&&clearTimeout(r),window.removeEventListener("ionKeyboardDidShow",s),window.removeEventListener("ionKeyboardDidShow",e),a&&await t(a,0,u.scrollAmount,u.scrollDuration),l(n,i,!1,u.inputSafeY),S(i),c&&b(i,a,(()=>h=0))},s=()=>{window.removeEventListener("ionKeyboardDidShow",s),window.addEventListener("ionKeyboardDidShow",e)};if(a){const t=await o(a);if(u.scrollAmount>t.scrollHeight-t.clientHeight-t.scrollTop)return"password"===i.type?(u.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",s)):window.addEventListener("ionKeyboardDidShow",e),void(r=setTimeout(e,1e3))}e()}},D=async(o,t)=>{const r=document,d="ios"===t,u="android"===t,f=o.getNumber("keyboardHeight",290),w=o.getBoolean("scrollAssist",!0),m=o.getBoolean("hideCaretOnScroll",d),b=o.getBoolean("inputBlurring",d),h=o.getBoolean("scrollPadding",!0),S=Array.from(r.querySelectorAll("ion-input, ion-textarea")),D=new WeakMap,v=new WeakMap,x=await c.getResizeMode(),k=async o=>{await new Promise((t=>e(o,t)));const t=o.shadowRoot||o,r=t.querySelector("input")||t.querySelector("textarea"),c=n(o),d=c?null:o.closest("ion-footer");if(r){if(c&&m&&!D.has(o)){const t=((o,t,n)=>{if(!n||!t)return()=>{};const r=n=>{var i;(i=t)===i.getRootNode().activeElement&&l(o,t,n)},e=()=>l(o,t,!1),s=()=>r(!0),c=()=>r(!1);return i(n,"ionScrollStart",s),i(n,"ionScrollEnd",c),t.addEventListener("blur",e),()=>{a(n,"ionScrollStart",s),a(n,"ionScrollEnd",c),t.removeEventListener("blur",e)}})(o,r,c);D.set(o,t)}if("date"!==r.type&&"datetime-local"!==r.type&&(c||d)&&w&&!v.has(o)){const t=((o,t,n,i,a,r,e,c=!1)=>{const d=r&&(void 0===e||e.mode===s.None),l=async()=>{t.hasAttribute(y)?t.removeAttribute(y):M(o,t,n,i,a,d,c)};return o.addEventListener("focusin",l,!0),()=>{o.removeEventListener("focusin",l,!0)}})(o,r,c,d,f,h,x,u);v.set(o,t)}}};b&&(()=>{let o=!0,t=!1;const n=document;i(n,"ionScrollStart",(()=>{t=!0})),n.addEventListener("focusin",(()=>{o=!0}),!0),n.addEventListener("touchend",(i=>{if(t)return void(t=!1);const a=n.activeElement;if(!a)return;if(a.matches(p))return;const r=i.target;r!==a&&(r.matches(p)||r.closest(p)||(o=!1,setTimeout((()=>{o||a.blur()}),50)))}),!1)})();for(const o of S)k(o);r.addEventListener("ionInputDidLoad",(o=>{k(o.detail)})),r.addEventListener("ionInputDidUnload",(o=>{(o=>{if(m){const t=D.get(o);t&&t(),D.delete(o)}if(w){const t=v.get(o);t&&t(),v.delete(o)}})(o.detail)}))};export{D as startInputShims}